# Ghostty ドキュメント翻訳オーケストレーター

## 入力

- `docs_dir`: ドキュメントディレクトリのパス
- `skill_dir`: スキルディレクトリのパス

## 手順

### 1. 準備スクリプトを実行

```bash
$skill_dir/scripts/prepare-translation.sh $docs_dir
```

このスクリプトが全ての前処理を行う：
- 英語ドキュメントの分割
- ハッシュベース差分検出
- 翻訳バッチファイルの作成

出力から `BATCH_COUNT`, `DOCS_DIR`, `TMP_DIR` の値を取得。

`BATCH_COUNT=0` なら「翻訳が必要なファイルはありません」と報告して終了。

### 2. 翻訳ワーカーの起動

`BATCH_COUNT` が1以上の場合、各バッチについて軽量なサブエージェントを起動。

ワーカーへの指示：
```
$skill_dir/instructions/translator.md を読んで、
docs_dir=$docs_dir として
$TMP_DIR/translate-batch-{n}.txt に記載されたファイルを翻訳してください。
```

複数バッチがある場合は並列で起動すること。

### 3. 結果集約と報告

全ワーカーの完了を待ち、結果を集約：

1. 各ワーカーの成功/失敗件数を合計
2. 翻訳したファイル一覧を `$TMP_DIR/translation-result.txt` に書き出し

報告内容は **自身のコンテキスト残量に応じて適応的に** 決定：

**コンテキストに余裕がある場合：**
- 結果リストを読んで要約を作成（カテゴリ別件数、主な変更点など）
- メインに要約付きで報告（メインのコンテキスト節約になる）

**コンテキストが逼迫している場合：**
- ファイルパスと件数のみ返す
- 要約作業はメインに委ねる

最小報告フォーマット：
```
成功: {件数}件、失敗: {件数}件
結果リスト: $TMP_DIR/translation-result.txt ({行数}件)
```

**重要**: 翻訳内容自体は絶対に返さない。要約やリストのみ。
